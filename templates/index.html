<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì‹¤ì‹œê°„ ë¦¬ëª¨ì»¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * { box-sizing: border-box; }

        body {
            background-color: #121212; margin: 0; 
            height: 100dvh; /* í™”ë©´ ì˜ë¦¼ ë°©ì§€ */
            width: 100vw;
            overflow: hidden; display: flex; flex-direction: column;
            color: #ccc; font-family: sans-serif; user-select: none;
        }
        
        /* 1. íŠ¸ë™íŒ¨ë“œ (ë‚˜ë¨¸ì§€ ê³µê°„ ì „ë¶€) */
        #main-area {
            flex: 1; display: flex; width: 100%; border-bottom: 2px solid #333; overflow: hidden; min-height: 0;
        }
        #trackpad { flex: 1; height: 100%; background-color: #1e1e1e; display: flex; justify-content: center; align-items: center; }
        #scrollbar { width: 50px; height: 100%; background-color: #2c2c2c; border-left: 1px solid #333; display: flex; justify-content: center; align-items: center; writing-mode: vertical-rl; font-size: 12px; }

        /* 2. ë³¼ë¥¨ ìŠ¬ë¼ì´ë” (ê³ ì • ë†’ì´ 70px) */
        #volume-area {
            height: 70px; flex: none;
            display: flex; align-items: center; justify-content: center;
            background-color: #181818; border-bottom: 1px solid #333; padding: 0 20px;
        }
        input[type=range] {
            -webkit-appearance: none; width: 100%; height: 10px;
            background: #333; border-radius: 5px; outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 25px; height: 25px; border-radius: 50%; 
            background: #4dabf7; cursor: pointer;
        }

        /* 3. ë²„íŠ¼ë“¤ (ê³ ì • ë†’ì´ 120px - 2ì¤„ì´ë‹ˆê¹Œ ë„‰ë„‰í•˜ê²Œ) */
        #controls {
            height: 120px; flex: none;
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr 1fr; 
            grid-template-rows: 1fr 1fr;
            gap: 1px; background-color: #000; padding: 1px;
            /* ì•„ì´í° í•˜ë‹¨ ë°” ì•ˆì „ ì˜ì—­ */
            padding-bottom: env(safe-area-inset-bottom, 5px); 
        }
        .btn { background-color: #333; border: none; color: white; font-size: 16px; font-weight: bold; }
        .btn:active { background-color: #555; }
        .blue-btn { color: #4dabf7; }
        .red-btn { color: #ff4d4d; background-color: #300000; }
        
        /* ìˆ¨ê²¨ì§„ ì…ë ¥ì°½ (í™”ë©´ ë°–ìœ¼ë¡œ ë³´ëƒ„) */
        #hiddenInput { position: absolute; opacity: 0; top: -1000px; }
    </style>
</head>
<body>
    <div id="main-area">
        <div id="trackpad">ë§ˆìš°ìŠ¤ / í„°ì¹˜</div>
        <div id="scrollbar">ìŠ¤í¬ë¡¤</div>
    </div>

    <div id="volume-area">
        <span style="margin-right:10px">ğŸ”‰</span>
        <input type="range" id="volSlider" min="0" max="100" value="50">
        <span style="margin-left:10px">ğŸ”Š</span>
    </div>

    <div id="controls">
        <button class="btn" onclick="toggleKeyboard()">âŒ¨ï¸ KBD</button>
        <button class="btn blue-btn" onclick="sendMacro('hangul')">í•œ/ì˜</button>
        <button class="btn" onclick="sendMacro('space')">â¯ Space</button>
        <button class="btn" onclick="sendMacro('backspace')">â† BKSP</button>
        
        <button class="btn" onclick="location.reload()">ğŸ”„ F5</button>
        <button class="btn" onclick="sendMacro('enter')">â†µ Enter</button>
        <button class="btn" style="font-size:12px" onclick="alert('ë²„ì „: ì‹¤ì‹œê°„ ì…ë ¥')">â„¹ï¸ Info</button>
        <button class="btn red-btn" onclick="confirmShutdown()">OFF</button>
    </div>

    <input type="text" id="hiddenInput" autocomplete="off">

    <script>
        var socket = io();
        
        // === [ì‹¤ì‹œê°„ í‚¤ë³´ë“œ ë¡œì§ ë³µêµ¬] ===
        var hiddenInput = document.getElementById('hiddenInput');
        
        function toggleKeyboard() {
            hiddenInput.focus();
            hiddenInput.click();
        }
        
        // ê¸€ìê°€ ì…ë ¥ë˜ëŠ” ìˆœê°„ ë°”ë¡œ ì „ì†¡í•˜ê³  ë¹„ì›€
        hiddenInput.addEventListener('input', function(e) {
            // e.dataì— ì…ë ¥ëœ ê¸€ìê°€ ë“¤ì–´ìˆìŒ (ì—†ìœ¼ë©´ valueì—ì„œ ê°€ì ¸ì˜´)
            var char = e.data || this.value.slice(-1); 
            
            if(char) {
                socket.emit('keyboard_input', {text: char});
            }
            
            // ì…ë ¥ì°½ ë¹„ìš°ê¸° (í° í™”ë©´ì—ì„œëŠ” ê¸€ìê°€ ì•ˆ ëª¨ì´ê³  ê³„ì† ì‚¬ë¼ì§€ëŠ” ê²Œ ì •ìƒì…ë‹ˆë‹¤!)
            this.value = ''; 
        });
        
        // ëª¨ë°”ì¼ í‚¤ë³´ë“œì˜ ì—”í„°/ë°±ìŠ¤í˜ì´ìŠ¤ ê°ì§€
        hiddenInput.addEventListener('keydown', function(e) {
            if(e.key === 'Enter') {
                socket.emit('macro_action', {command: 'enter'});
            } else if (e.key === 'Backspace') {
                // input ì´ë²¤íŠ¸ë¡œ ì²˜ë¦¬ê°€ ì•ˆ ë  ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ë°±ìŠ¤í˜ì´ìŠ¤
                socket.emit('macro_action', {command: 'backspace'});
            }
        });

        // === [ë³¼ë¥¨ ìŠ¬ë¼ì´ë”] ===
        var volSlider = document.getElementById('volSlider');
        var lastVol = 50;
        volSlider.addEventListener('input', function() {
            var currentVol = this.value;
            if (currentVol > lastVol) socket.emit('macro_action', {command: 'vol_up'});
            else if (currentVol < lastVol) socket.emit('macro_action', {command: 'vol_down'});
            if(navigator.vibrate) navigator.vibrate(5);
            lastVol = currentVol;
        });
        volSlider.addEventListener('touchend', function() { this.value = 50; lastVol = 50; });

        // === [ë§ˆìš°ìŠ¤ ë¡œì§] ===
        var lastX=0, lastY=0, scrollLastY=0;
        var sensitivity = 2.5;
        var touchStartTime=0, isDragging=false, maxFingers=0;
        var trackpad = document.getElementById('trackpad');
        
        trackpad.addEventListener('touchstart', function(e) {
            lastX = e.touches[0].clientX; lastY = e.touches[0].clientY;
            touchStartTime = new Date().getTime(); isDragging = false; maxFingers = e.touches.length;
        }, {passive: false});
        trackpad.addEventListener('touchmove', function(e) {
            e.preventDefault(); isDragging = true; maxFingers = Math.max(maxFingers, e.touches.length);
            var cx = e.touches[0].clientX; var cy = e.touches[0].clientY;
            socket.emit('mouse_move', {x:(cx-lastX)*sensitivity, y:(cy-lastY)*sensitivity});
            lastX = cx; lastY = cy;
        }, {passive: false});
        trackpad.addEventListener('touchend', function(e) {
            if (new Date().getTime() - touchStartTime < 250 && !isDragging) {
                socket.emit('mouse_click', {type: maxFingers===2?'right':'left'});
                if(navigator.vibrate) navigator.vibrate(30);
            }
        });

        var scrollbar = document.getElementById('scrollbar');
        scrollbar.addEventListener('touchstart', function(e){ scrollLastY = e.touches[0].clientY; }, {passive: false});
        scrollbar.addEventListener('touchmove', function(e) {
            e.preventDefault();
            var cy = e.touches[0].clientY;
            socket.emit('mouse_scroll', {dy: cy - scrollLastY});
            scrollLastY = cy;
        }, {passive: false});

        function sendMacro(cmd) {
            socket.emit('macro_action', {command: cmd});
            if(navigator.vibrate) navigator.vibrate(30);
        }
        function confirmShutdown() {
            if(confirm("PCë¥¼ ë•ë‹ˆë‹¤?")) sendMacro('shutdown');
        }
    </script>
</body>
</html>